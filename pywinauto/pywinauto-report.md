# Win32 API

**Win32 API** – это набор функций (*API – Application Programming Interface*), работающих под управлением ОС Windows.

С помощью Win32 API можно создавать различные оконные процедуры, диалоговые окна, программы и даже игры.

Разработчик несет ответственность за создание доступных и понятных конечному пользователю программных интерфейсов.

Win32 API существует с 1985 года и используется в огромном количестве программных решений, поэтому создание управляемых Win32 API приложений - важный навык в работе программиста.

Но иногда пользовательского интерфейса, предоставленного разработчиком, не хватает для достижения желаемого результата. Например, необходимо использовать одну программу с графическим интерфейсом множество раз для выполнения какой-нибудь рутинной работы. Но разработчиком не предусмотрена возможность для автоматизации пользовательских действий, и приходится рассматривать вариант управления приложением из других программ.

На помощь приходят Win32 Accessibility технологии.

# Win32 Accessibility

Для того чтобы получить программный доступ к внутренностям Win32 API приложений, существуют ориентированные на управление API (API для управления другими API).

На операционной системе Windows существует 2 вида API, позволяющих получить программный доступ к элементам управления Win32 API:

- **Microsoft Active Accessibility (MSAA)**: старый управляющий интерфейс, основанный на интерфейсе IAccessible Component Object Model (COM).
- **User Interface Automation (UIA)**: управляющий API, поддерживаемый более новыми элементами управления, который также может воспользоваться интерфейсом MSAA для получения доступа к элементам управления.

## Microsoft Active Accessibility

MSAA - технология, основанная на Component Object Model (COM) - модели, описывающей правила взаимодействия приложений и операционной системы - и предоставляющая средства для работы с приложениями, работающими на операционной системе Microsoft Windows. Она включает в себя динамически подключаемые библиотеки, включенные в операционную систему, а также COM-интерфейс и элементы API, которые дают возможность получить информацию об элементах пользовательского интерфейса и веб-контента.

Используя эту информацию, вспомогательные программные продукты могут представить пользовательский интерфейс приложения в абсолютно другом виде, например, как речь или шрифт Брайля, и с помощью голосовых команд человек может удаленно управлять пользовательским интерфейсом.

MSAA состоит из следующих компонент:

- IAccessible COM-интерфейс, который позволяет получить информацию об элементах пользовательского интерфейса, а также управлять ими.
- WinEvents - событийная система, позволяющая серверу оповестить клиентов о том, что управляемый объект изменил свое состояние.
- Вспомогательная библиотека Oleacc.dll.

## User Interface Automation

UIA представляет из себя библиотеку виртуализации дерева элементов пользовательского интерфейса произвольного Win32, Windows Forms или WPF приложения, с возможностью последующего доступа к свойствам этих элементов, а также их управлением.  UIA  является практически прямым наследником MSAA. 

UIA состоит из следующих компонент:

- Provider API (UIAutomationProvider.dll, UIAutomationTypes.dll) - набор функций, позволяющих получить информацию об элементах пользовательского интерфейса и принять пользовательский ввод.
- Client API (UIAutomationClient.dll, UIAutomationTypes.dll) - набор типов для управляющего кода, которые получают информацию о пользовательском интерфейсе и отправляют пользовательский ввод элементам интерфейса.
- UiAutomationCore.dll - базовый код, обеспечивающий взаимодействие между поставщиками и клиентами.
- UIAutomationClientsideProviders.dll - набор UI Automation поставщиков для стандартных элементов пользовательского интерфейса.

Каждый элемент пользовательского интерфейса представляется в виде объекта типа AutomationElement, который предоставляет методы для получения свойств элемента, поиска его дочерних элементов, генерации событий.

### AutomationElement

TBD

# Литература

1. Windows (Win32) Accessibility for Developers. URL: <https://msdn.microsoft.com/en-us/windows/desktop/gg712214.aspx> (дата обращения: 07.05.2016).
2. Microsoft Active Accessibility. URL: <https://msdn.microsoft.com/en-us/library/windows/desktop/dd373592(v=vs.85).aspx> (дата обращения 07.05.2016).
3. UI Automation. URL: <https://msdn.microsoft.com/en-us/library/ms747327(v=vs.110).aspx> (дата обращения 07.05.2016).
4. Написание автоматических тестов для тестирования пользовательского интерфейса десктопных приложений. URL: <https://habrahabr.ru/post/124110/> (дата обращения 07.05.2016).
